<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>
<style>
    /* Reset defaults */
    html,
    body {
        margin: 0;
        padding: 0;
        overflow: hidden;
        background-color: #111;
        /* dark background for contrast */
        font-family: Arial, sans-serif;
    }

    /* Score + HighScore display */
    #score,
    #highScore {
        position: absolute;
        top: 10px;
        left: 10px;
        padding: 6px 12px;
        margin: 0;
        border-radius: 6px;
        background: rgba(0, 0, 0, 0.6);
        font-size: 18px;
        font-weight: bold;
        color: aqua;
        user-select: none;
    }

    #highScore {
        top: 40px;
        color: gold;
    }

    /* Canvas centered */
    #mycanvas {
        display: block;
        border: 2px solid #444;
        background: radial-gradient(circle at center, #222, #000);
    }

    /* Restart button */
    #restartBtn {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        padding: 15px 30px;
        font-size: 22px;
        font-weight: bold;
        border: none;
        border-radius: 10px;
        background: linear-gradient(135deg, #00f, #0ff);
        color: white;
        cursor: pointer;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.5);
        transition: transform 0.2s, background 0.3s;
        display: none;
    }

    #restartBtn:hover {
        transform: translate(-50%, -50%) scale(1.1);
        background: linear-gradient(135deg, #0ff, #00f);
    }
</style>

<body>
    <p id="score" style="color: aqua;background-color: black;"></p>
    <p id="highScore" style="color: aqua;background-color: black;margin-top: 2px; "></p>
    <canvas id="mycanvas" style="border: 1px solid;"></canvas>
    <button id="restartBtn" style="position:absolute; top:50%; left:50%; transform:translate(-50%,-50%);
               padding:15px 30px; font-size:20px; display:none; cursor:pointer;">
        Restart Game
    </button>
    <audio id="bulletsound" src="bulletsound.mp3"></audio>
    <audio id="explosion" src="explosion.mp3"></audio>
    <script>
        let highScore = localStorage.getItem("highScore") || 0;
        let gamerunning = true;
        let animationId;
        let score = 0;
        let angle = Math.PI / 4;
        let enemyspawnspeed = 1000;
        let b_radius = 4;
        let v = 4;
        let v_enemies = 1;
        let pressed = false;
        const bullets = [];
        const enemys = [];
        const canvas = document.getElementById("mycanvas");
        const ctx = canvas.getContext("2d");

        function randomPosition(minDistance = 200) {
            let x, y, dx, dy, dist;
            do {
                x = Math.random() * canvas.width;
                y = Math.random() * canvas.height;
                dx = x - canvas.width / 2;
                dy = y - canvas.height / 2;
                dist = Math.sqrt(dx * dx + dy * dy);
            } while (dist < minDistance); // keep trying until outside safe zone
            return { x, y };
        }

        function addEnemies() {
            let pos = randomPosition(150); // 150px away from cannon center
            enemys.push(pos);
        }


        function resizecanvas() {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
        }
        function playShoot() {
            let shoot = document.getElementById("bulletsound");
            shoot.currentTime = .5; // rewind to start if already playing
            shoot.play();
        }

        function playExplosion() {
            let explosion = document.getElementById("explosion");
            explosion.currentTime = .4;
            explosion.play();
        }

        function draw_canon() {
            ctx.beginPath();
            ctx.fillStyle = "red";
            ctx.arc(canvas.width / 2, canvas.height / 2, 80, 0, 2 * Math.PI);
            ctx.fill();
            ctx.strokeStyle = "greenyellow";
            ctx.lineWidth = 5;
            ctx.stroke();
            ctx.beginPath();
            ctx.fillStyle = "orange";
            ctx.arc(canvas.width / 2, canvas.height / 2, 40, 0, 2 * Math.PI);
            ctx.fill();
            ctx.strokeStyle = "red";
            ctx.lineWidth = 5;
            ctx.stroke();
            drawRotatedRect(canvas.width / 2, canvas.height / 2, 120, 30, angle);
        }

        function drawRotatedRect(x, y, w, h, angle) {
            ctx.save();
            ctx.translate(x, y);
            ctx.rotate(angle);             // save current state
            ctx.fillStyle = "orange";
            ctx.fillRect(0, -h / 2, w, h);
            ctx.restore();
        }

        function shootBullet() {
            bullets.push({
                x: canvas.width / 2 + Math.cos(angle) * 120,
                y: canvas.height / 2 + Math.sin(angle) * 120,
                angle: angle
            });
        }
        // Draw a bullet
        function drawBullet(b) {
            ctx.beginPath();
            ctx.arc(b.x, b.y, b_radius, 0, 2 * Math.PI);
            ctx.fillStyle = "yellow";
            ctx.fill();
            ctx.closePath();
        }

        function isColliding(bullet, enemy) {
            let dx = bullet.x - enemy.x;
            let dy = bullet.y - enemy.y;
            let dist = Math.sqrt(dx * dx + dy * dy);
            return dist < b_radius * 2 + 10 + 1; // bullet radius + enemy radius
            // 1-----> is genrosity factor
        }


        function drawEnemies(b) {
            ctx.beginPath();
            ctx.arc(b.x, b.y, 10, 0, 2 * Math.PI);
            ctx.fillStyle = "red";
            ctx.fill();
            ctx.closePath();
        }

        function lightEffect(b) {
            ctx.beginPath();
            ctx.arc(b.x, b.y, 100, 0, Math.PI * 2);
            ctx.fillStyle = "rgba(0,255,255,0.05)";
            ctx.fill();
        }
        function gameOver() {
            // stop game loop (do not call animate again)
            gamerunning = false;
            cancelAnimationFrame(animationId);

            // show Game Over text
            ctx.fillStyle = "black";
            ctx.fillRect(0, 0, canvas.width, canvas.height)
            ctx.font = "40px Arial";
            ctx.fillText("Game Over!", canvas.width / 2 - 100, canvas.height / 2 - 50);

            // show restart button
            clearInterval(setintervalid);
            clearInterval(increasedifficultyid)
            document.getElementById("restartBtn").style.display = "block";
        }

        function restartGame() {
            // reset everything
            gamerunning = true;
            score = 0;
            bullets.length = 0;
            enemys.length = 0;
            angle = Math.PI / 4;
            enemyspawnspeed = 1000;  
            v_enemies = 1;
            // hide restart button
            document.getElementById("restartBtn").style.display = "none";
            setintervalid = setInterval(addEnemies, enemyspawnspeed);
            increasedifficultyid = setInterval(increasedifficulty, 10000);
            // restart loop
            animate();
        }

        function increasedifficulty() {
            if (enemyspawnspeed > 120)
                enemyspawnspeed -= 100;
            clearInterval(setintervalid);
            setintervalid = setInterval(addEnemies, enemyspawnspeed);


            v_enemies = v_enemies + .5
        }


        let setintervalid = setInterval(addEnemies, enemyspawnspeed);
        let increasedifficultyid = setInterval(increasedifficulty, 10000)
        function animate() {

            // Draw semi-transparent background for trail
            ctx.fillStyle = "rgba(0,0,0,0.1)";
            ctx.fillRect(0, 0, canvas.width, canvas.height);



            // Update bullets
            for (let i = bullets.length - 1; i >= 0; i--) {
                let b = bullets[i];
                // Move bullet
                b.x += v * Math.cos(b.angle);
                b.y += v * Math.sin(b.angle);

                // Draw bullet and light
                drawBullet(b);
                lightEffect(b);



                // Remove bullet if off screen
                if (b.x < 0 || b.x > canvas.width || b.y < 0 || b.y > canvas.height) {
                    bullets.splice(i, 1);
                }
                for (let j = enemys.length - 1; j >= 0; j--) {
                    if (isColliding(b, enemys[j])) {
                        score += 100;
                        playExplosion();
                        bullets.splice(i, 1);  // remove bullet
                        enemys.splice(j, 1);   // remove enemy
                        break;                 // bullet gone, stop checking further
                    }
                }
            }
            for (let i = enemys.length - 1; i >= 0; i--) {
                let b = enemys[i];
                // move enemy toward center
                let dx = canvas.width / 2 - b.x;
                let dy = canvas.height / 2 - b.y;
                let dist = Math.sqrt(dx * dx + dy * dy);
                b.x += (dx / dist) * v_enemies;
                b.y += (dy / dist) * v_enemies;
                drawEnemies(b);


                if (dist <= 80) {
                    score -= 100;// reached center
                    enemys.splice(i, 1);
                }
            }

            document.getElementById("score").innerHTML = "Score:- " + score;
            if (score <= -100) {
                gameOver();
                return; // stop loop
            }
            animationId = requestAnimationFrame(animate);
            document.getElementById("score").innerHTML = "Score:- " + score;
            if (score > highScore) {
                highScore = score
                localStorage.setItem("highScore", score);
            }
            document.getElementById("highScore").innerHTML = "HighScore:-" + highScore;

        }

        animate();

        window.addEventListener("keydown", (e) => {
            if (!gamerunning) return;
            if (e.key === "ArrowRight") {
                angle += Math.PI / 30; // rotate clockwise
                draw_canon();

            }
            else if (e.key === "ArrowLeft") {
                angle -= Math.PI / 30; // rotate counterclockwise
                draw_canon();
            }
            else if (e.code === "Space" && !pressed) {
                shootBullet();
                playShoot();
                draw_canon();
                pressed = true;

            }
            window.addEventListener("keyup", (e) => {
                if (e.code === "Space") {
                    pressed = false; // reset flag when key is released
                }
            });

        });

        document.addEventListener("mousedown", (e) => {
            if (!gamerunning) return
            if (e.button == 0) {
                shootBullet();
                draw_canon();
                playShoot();
            }
        });

        document.addEventListener("wheel", function (event) {
            if (!gamerunning) return;
            if (event.deltaY < 0) {
                angle += Math.PI / 30;
                draw_canon();
            }
            else {

                angle -= Math.PI / 30;
                draw_canon();
            }
        });
        window.addEventListener("load", resizecanvas);
        document.getElementById("restartBtn").addEventListener("click", restartGame);


    </script>
</body>

</html>